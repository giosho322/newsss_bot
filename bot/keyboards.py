#!/usr/bin/env python3
"""
ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñ‹ Ğ´Ğ»Ñ Ğ±Ğ¾Ñ‚Ğ°
Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ñ‹ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¼ĞµĞ½Ñ Ğ¸ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ Ñ Ğ¿Ğ¾ÑÑ‚Ğ°Ğ¼Ğ¸
"""

from aiogram.types import (
    InlineKeyboardMarkup,
    InlineKeyboardButton,
    ReplyKeyboardMarkup,
    KeyboardButton,
)
from database.db import get_or_create_link_token

def get_main_menu() -> ReplyKeyboardMarkup:
    """Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ (reply-ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ°)"""
    return ReplyKeyboardMarkup(
        keyboard=[
            [KeyboardButton(text="ğŸ“° ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾ÑÑ‚Ğ¸"), KeyboardButton(text="ğŸ“Š Ğ¢Ğ¾Ğ¿ Ğ·Ğ° ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ")],
            [KeyboardButton(text="ğŸ” ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑƒ"), KeyboardButton(text="â­ Ğ˜Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ")],
            [KeyboardButton(text="ğŸ“ˆ Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°"), KeyboardButton(text="âš™ï¸ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸")],
        ],
        resize_keyboard=True,
        input_field_placeholder="Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ"
    )

def get_main_keyboard() -> InlineKeyboardMarkup:
    """Ğ˜Ğ½Ğ»Ğ°Ğ¹Ğ½-Ğ¼ĞµĞ½Ñ (Ğ´Ğ»Ñ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹)"""
    keyboard = [
        [InlineKeyboardButton(text="ğŸ“° Ğ¢Ğ¾Ğ¿ Ğ½Ğ¾Ğ²Ğ¾ÑÑ‚ĞµĞ¹", callback_data="top_news")],
        [InlineKeyboardButton(text="ğŸ“… ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ¹Ğ´Ğ¶ĞµÑÑ‚", callback_data="digest")],
        [InlineKeyboardButton(text="âš™ï¸ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸", callback_data="settings")],
        [InlineKeyboardButton(text="ğŸ“– Ğ¡Ğ¿Ñ€Ğ°Ğ²ĞºĞ°", callback_data="help")]
    ]
    return InlineKeyboardMarkup(inline_keyboard=keyboard)

def get_settings_keyboard() -> InlineKeyboardMarkup:
    """ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº"""
    keyboard = [
        [InlineKeyboardButton(text="ğŸ“º ĞšĞ°Ğ½Ğ°Ğ»Ñ‹", callback_data="settings_channels")],
        [InlineKeyboardButton(text="ğŸ“Š ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ½Ğ¾Ğ²Ğ¾ÑÑ‚ĞµĞ¹", callback_data="settings_news_count")],
        [InlineKeyboardButton(text="ğŸ”™ ĞĞ°Ğ·Ğ°Ğ´", callback_data="main_menu")]
    ]
    return InlineKeyboardMarkup(inline_keyboard=keyboard)

def get_channels_keyboard() -> InlineKeyboardMarkup:
    """ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° ĞºĞ°Ğ½Ğ°Ğ»Ğ¾Ğ²"""
    keyboard = [
        [InlineKeyboardButton(text="ğŸ”™ ĞĞ°Ğ·Ğ°Ğ´", callback_data="settings")],
        [InlineKeyboardButton(text="ğŸ  Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ", callback_data="main_menu")]
    ]
    return InlineKeyboardMarkup(inline_keyboard=keyboard)

def get_digest_keyboard() -> InlineKeyboardMarkup:
    """ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ°Ğ¹Ğ´Ğ¶ĞµÑÑ‚Ğ°"""
    keyboard = [
        [InlineKeyboardButton(text="ğŸ”„ ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ", callback_data="digest")],
        [InlineKeyboardButton(text="ğŸ  Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ", callback_data="main_menu")]
    ]
    return InlineKeyboardMarkup(inline_keyboard=keyboard)

def get_admin_keyboard() -> InlineKeyboardMarkup:
    """ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸"""
    keyboard = [
        [InlineKeyboardButton(text="ğŸ“Š Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°", callback_data="admin_stats")],
        [InlineKeyboardButton(text="ğŸ“¢ Ğ Ğ°ÑÑÑ‹Ğ»ĞºĞ°", callback_data="admin_broadcast")],
        [InlineKeyboardButton(text="ğŸ”™ ĞĞ°Ğ·Ğ°Ğ´", callback_data="main_menu")]
    ]
    return InlineKeyboardMarkup(inline_keyboard=keyboard)

def get_broadcast_keyboard() -> InlineKeyboardMarkup:
    """ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ñ€Ğ°ÑÑÑ‹Ğ»ĞºĞ¸"""
    keyboard = [
        [InlineKeyboardButton(text="ğŸ“¤ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ²ÑĞµĞ¼", callback_data="admin_broadcast_all")],
        [InlineKeyboardButton(text="ğŸ‘¤ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ", callback_data="admin_broadcast_user")],
        [InlineKeyboardButton(text="ğŸ”™ ĞĞ°Ğ·Ğ°Ğ´", callback_data="admin_panel")],
        [InlineKeyboardButton(text="ğŸ  Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ", callback_data="main_menu")]
    ]
    return InlineKeyboardMarkup(inline_keyboard=keyboard)

def get_help_keyboard() -> InlineKeyboardMarkup:
    """ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° ÑĞ¿Ñ€Ğ°Ğ²ĞºĞ¸"""
    keyboard = [
        [InlineKeyboardButton(text="ğŸ  Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ", callback_data="main_menu")]
    ]
    return InlineKeyboardMarkup(inline_keyboard=keyboard)

def get_post_keyboard(link: str, post_id: str | None = None) -> InlineKeyboardMarkup:
    """ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ¿Ğ¾Ğ´ Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ¼: Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ÑŒ, ĞºÑ€Ğ°Ñ‚ĞºĞ¾, Ğ¿Ğ¾Ğ»Ğ½Ğ°Ñ, ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ.
    Ğ”Ğ»Ñ callback Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğ¹ Ñ‚Ğ¾ĞºĞµĞ½, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğµ Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞ°Ñ‚ÑŒ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ 64 Ğ±Ğ°Ğ¹Ñ‚Ğ°.
    """
    rows = [[InlineKeyboardButton(text="ğŸ”— ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ", url=link)]]
    token = post_id or get_or_create_link_token(link)
    if token:
        rows.append([
            InlineKeyboardButton(text="ğŸ“ ĞšÑ€Ğ°Ñ‚ĞºĞ¾", callback_data=f"tldr:{token}"),
            InlineKeyboardButton(text="ğŸ“– ĞŸĞ¾Ğ»Ğ½Ğ°Ñ", callback_data=f"full:{token}"),
        ])
        rows.append([InlineKeyboardButton(text="ğŸ’¾ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ", callback_data=f"save:{token}")])
    return InlineKeyboardMarkup(inline_keyboard=rows)

def get_top_news_buttons(more_callback_data: str = "more_top_news:1") -> InlineKeyboardMarkup:
    return InlineKeyboardMarkup(
        inline_keyboard=[
            [InlineKeyboardButton(text="ğŸ”„ Ğ•Ñ‰Ğµ Ğ½Ğ¾Ğ²Ğ¾ÑÑ‚Ğ¸", callback_data=more_callback_data)],
            [InlineKeyboardButton(text="ğŸ  Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ", callback_data="main_menu")],
        ]
    )